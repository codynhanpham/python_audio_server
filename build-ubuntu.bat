@REM Create a temporary container to build the project
@REM Using the trusty-python37 image, and the git repo github.com/codynhanpham/python_audio_server

@REM Use this command to build the project with SimpleAudio and FFmpeg
@REM Just in case PyInstaller cannot find .so libs files, copy the scipy.libs folder (inside of linux-venv/lib/python3.7/site-packages) to the bin folder here
docker run --name python37-audio-server-build-temp -v "%cd%:/app" trusty-python37 /bin/sh -c "cd /app && python3.7 -m venv linux-venv && . linux-venv/bin/activate &&pip3 install --upgrade pip setuptools wheel  && pip3 install llvmlite==0.32.1 numba==0.49.1 && pip3 install -U numpy resampy==0.3.1 simpleaudio argparse pydub flask waitress python-dotenv scipy && pip3 install pyinstaller==5.13.2 && pip3 freeze > requirements_linux.txt && export PATH=\"/app/bin/scipy.libs:$PATH\" && pyinstaller -F --name py_audio_server --add-binary=\"bin/ffmpeg:bin\" --add-binary=\"bin/ffprobe:bin\" --add-binary=\"bin/async_get.exe:bin\" --hidden-import=\"scipy.special.cython_special\" main.py" && docker rm python37-audio-server-build-temp